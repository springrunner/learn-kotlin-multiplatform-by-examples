/*
 * This source file was generated by the Gradle 'init' task
 */
package coffeehouse

import coffeehouse.contract.order.Order.PlaceOrderRequest
import coffeehouse.contract.order.Order.PlaceOrderResponse
import coffeehouse.contract.order.OrderServiceGrpcKt
import io.grpc.ServerBuilder
import kotlinx.coroutines.runBlocking
import java.util.*

class OrderServiceImpl : OrderServiceGrpcKt.OrderServiceCoroutineImplBase() {
    override suspend fun placeOrder(request: PlaceOrderRequest): PlaceOrderResponse {
        val orderId = UUID.randomUUID().toString()
        println("ğŸ“¦ ì£¼ë¬¸ ìƒì„±: ê³ ê°ID=${request.customerId}, ì£¼ë¬¸ID=$orderId, ì£¼ë¬¸ ëª©ë¡=${request.orderLinesList}")
        return PlaceOrderResponse.newBuilder().setOrderId(orderId).build()
    }
}

fun main() = runBlocking {
    val server = ServerBuilder
        .forPort(50051)
        .addService(OrderServiceImpl())
        .build()
        .start()

    println("âœ… gRPC ì»¤í”¼ ì£¼ë¬¸ ì„œë²„ ì‹¤í–‰ ì¤‘... (í¬íŠ¸ 50051)")
    server.awaitTermination()
}
